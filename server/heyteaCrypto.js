const CryptoJS = require('crypto-js');\n\nconst MOBILE_KEY = CryptoJS.enc.Utf8.parse('23290CFFBB5D39B8');\nconst RESPONSE_KEY_APP = CryptoJS.enc.Utf8.parse('F61niK84bDQAsVHy');\nconst RESPONSE_KEY_WEAPP = CryptoJS.enc.Utf8.parse('ByOCfgNpMRKtwWhJ');\nconst IV = CryptoJS.enc.Utf8.parse('HEYTEA1A2B3C4D5E');\nconst ENCRYPTION_PREFIX = 'HEYTEA_ENCRYPTION_TRANSMISSION';\nconst SIGN_SALT = 'r5YWPjgSGAT2dbOJzwiDBK';\n\nfunction encryptHeyteaMobile(mobile) {\n  const data = CryptoJS.enc.Utf8.parse(String(mobile).trim());\n  const encrypted = CryptoJS.AES.encrypt(data, MOBILE_KEY, {\n    iv: IV,\n    mode: CryptoJS.mode.CBC,\n    padding: CryptoJS.pad.Pkcs7,\n  });\n  return CryptoJS.enc.Base64.stringify(encrypted.ciphertext);\n}\n\nfunction timestampSign(userMainId, timestamp) {\n  const raw = ${SIGN_SALT};\n  return CryptoJS.MD5(raw).toString();\n}\n\nfunction decryptResponseData(payload, isApp = false) {\n  if (typeof payload !== 'string' || !payload.startsWith(ENCRYPTION_PREFIX)) {\n    return payload;\n  }\n\n  const base64Body = payload.slice(ENCRYPTION_PREFIX.length);\n  const encrypted = CryptoJS.enc.Base64.parse(base64Body);\n  const key = isApp ? RESPONSE_KEY_APP : RESPONSE_KEY_WEAPP;\n  const cipherParams = CryptoJS.lib.CipherParams.create({ ciphertext: encrypted });\n  const decrypted = CryptoJS.AES.decrypt(cipherParams, key, {\n    iv: IV,\n    mode: CryptoJS.mode.CBC,\n    padding: CryptoJS.pad.Pkcs7,\n  });\n\n  const text = CryptoJS.enc.Utf8.stringify(decrypted);\n  return JSON.parse(text);\n}\n\nmodule.exports = {\n  encryptHeyteaMobile,\n  timestampSign,\n  decryptResponseData,\n};
